<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å½±è§†å…¨æµç¨‹æˆæœ¬è®¡ç®—å™¨</title>
    <style>
        :root { --primary: #6366f1; --bg: #f8fafc; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; color: #1e293b; }
        .container { background: white; padding: 2rem; border-radius: 20px; box-shadow: 0 10px 15px rgba(0,0,0,0.05); width: 100%; max-width: 450px; }
        h2 { text-align: center; color: var(--primary); margin-bottom: 1.5rem; }
        .group { margin-bottom: 1rem; }
        label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 0.4rem; color: #64748b; }
        select, input { width: 100%; padding: 0.8rem; border: 1px solid #e2e8f0; border-radius: 10px; font-size: 1rem; outline: none; }
        .result-card { background: #f1f5f9; padding: 1.2rem; border-radius: 12px; margin-top: 1.5rem; text-align: center; border: 2px solid var(--primary); }
        .total-price { font-size: 2rem; font-weight: 800; color: var(--primary); }
        .note { font-size: 0.75rem; color: #94a3b8; margin-top: 0.5rem; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ¬ AI å½±è§†æˆæœ¬åŠ©æ‰‹</h2>
    
    <div class="group">
        <label>1. é€‰æ‹©åŠŸèƒ½ç¯èŠ‚</label>
        <select id="funcSelect" onchange="initModels()"></select>
    </div>

    <div class="group">
        <label>2. é€‰æ‹©å…·ä½“æ¨¡å‹</label>
        <select id="modelSelect" onchange="updateUI()"></select>
    </div>

    <div class="group" id="durationBox">
        <label id="unitLabel">æ—¶é•¿/æ•°é‡</label>
        <input type="number" id="quantity" value="5" oninput="calculate()">
    </div>

    <div class="result-card">
        <label>é¢„ä¼°æ€»æˆæœ¬ (RMB)</label>
        <div class="total-price" id="totalDisplay">Â¥ 0.00</div>
        <div class="note" id="priceNote">åŠ è½½ä¸­...</div>
    </div>
</div>

<script>
    let rawData = {};
    const JSON_URL = 'https://raw.githubusercontent.com/guoguoguoguoguo-lab/ai-price-calculator/main/prices.json';

    async function loadData() {
        const res = await fetch(JSON_URL);
        rawData = await res.json();
        const functions = [...new Set(rawData.models.map(m => m.function))];
        const funcSelect = document.getElementById('funcSelect');
        functions.forEach(f => funcSelect.add(new Option(f, f)));
        initModels();
    }

    function initModels() {
        const selectedFunc = document.getElementById('funcSelect').value;
        const modelSelect = document.getElementById('modelSelect');
        modelSelect.innerHTML = '';
        const filtered = rawData.models.filter(m => m.function === selectedFunc);
        filtered.forEach(m => modelSelect.add(new Option(m.name, m.official_id)));
        updateUI();
    }

    function updateUI() {
        const model = getSelectedModel();
        document.getElementById('unitLabel').innerText = `è¾“å…¥æ•°é‡ (${model.unit})`;
        document.getElementById('priceNote').innerText = `å•ä»·: ${model.price} ${model.currency} / ${model.unit}`;
        calculate();
    }

    function getSelectedModel() {
        const id = document.getElementById('modelSelect').value;
        return rawData.models.find(m => m.official_id === id);
    }

    function calculate() {
        const model = getSelectedModel();
        const q = parseFloat(document.getElementById('quantity').value) || 0;
        let cost = 0;

        // æ ¸å¿ƒè®¡ç®—é€»è¾‘
        if (model.unit === "5ç§’") {
            cost = Math.ceil(q / 5) * model.price;
        } else {
            cost = q * model.price;
        }

        // æ±‡ç‡è½¬æ¢ (å¦‚æœæ˜¯ç¾å…ƒ)
        if (model.currency === "USD") {
            cost = cost * rawData.config.usd_to_rmb;
        }

        document.getElementById('totalDisplay').innerText = `Â¥ ${cost.toFixed(2)}`;
    }

    loadData();
</script>
</body>
</html>
